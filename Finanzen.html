<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Familien Finanzen</title>
    <!-- Firebase SDK einbinden -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .month-display {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #3498db;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 500;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card.income {
            border-left: 5px solid #27ae60;
        }
        
        .card.expense {
            border-left: 5px solid #e74c3c;
        }
        
        .card.fixkosten {
            border-left: 5px solid #f39c12;
        }
        
        .card.balance {
            border-left: 5px solid #3498db;
        }
        
        .card.balance.negative {
            border-left: 5px solid #e74c3c;
        }
        
        .card.cekilem {
            border-left: 5px solid #2980b9;
        }
        
        .card.ersparnis {
            border-left: 5px solid #9b59b6;
        }
        
        .card h3 {
            margin-bottom: 10px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .card .amount {
            font-size: 24px;
            font-weight: bold;
        }
        
        .income .amount {
            color: #27ae60;
        }
        
        .expense .amount {
            color: #e74c3c;
        }
        
        .fixkosten .amount {
            color: #f39c12;
        }
        
        .balance .amount {
            color: #3498db;
        }
        
        .balance.negative .amount {
            color: #e74c3c;
        }
        
        .ersparnis .amount {
            color: #9b59b6;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            background: #ecf0f1;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            border: none;
            font-size: 16px;
        }
        
        .tab.active {
            background: #3498db;
            color: white;
        }
        
        .tab-content {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
        }
        
        .form-group select,
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group select:focus,
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .btn {
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-add {
            background: #27ae60;
            color: white;
            width: 100%;
        }
        
        .btn-add:hover {
            background: #229954;
            transform: translateY(-2px);
        }
        
        .btn-save {
            background: #3498db;
            color: white;
            margin-top: 20px;
            width: 100%;
        }
        
        .btn-save:hover {
            background: #2980b9;
        }
        
        .transactions {
            background: white;
            border-radius: 10px;
            box-shadow:  0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .transactions h3 {
            padding: 20px;
            background: #2c3e50;
            color: white;
            margin: 0;
        }
        
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #ecf0f1;
            transition: background-color 0.3s ease;
        }
        
        .transaction-item:hover {
            background: #f8f9fa;
        }
        
        .transaction-item:last-child {
            border-bottom: none;
        }
        
        .transaction-info {
            flex: 1;
        }
        
        .transaction-category {
            font-weight: 500;
            color: #2c3e50;
        }
        
        .transaction-description {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 2px;
        }
        
        .transaction-date {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 2px;
        }
        
        .transaction-due-date {
            font-size: 12px;
            color: #e74c3c;
            margin-top: 2px;
            font-weight: 500;
        }
        
        .transaction-amount {
            font-weight: bold;
            font-size: 18px;
        }
        
        .transaction-amount.income {
            color: #27ae60;
        }
        
        .transaction-amount.expense {
            color: #e74c3c;
        }
        
        .transaction-actions {
            display: flex;
            gap: 5px;
        }
        
        .edit-btn, .delete-btn {
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .edit-btn {
            background: #3498db;
        }
        
        .edit-btn:hover {
            background: #2980b9;
        }
        
        .delete-btn {
            background: #e74c3c;
        }
        
        .delete-btn:hover {
            background: #c0392b;
        }
        
        .budget-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .budget-item {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ecf0f1;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .budget-item:hover {
            background-color: #f8f9fa;
        }
        
        .budget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .budget-progress {
            width: 100%;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        
        .budget-progress-bar {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }
        
        .budget-progress-bar.safe {
            background: #27ae60;
        }
        
        .budget-progress-bar.warning {
            background: #f39c12;
        }
        
        .budget-progress-bar.danger {
            background: #e74c3c;
        }
        
        .budget-text {
            font-size: 12px;
            color: #7f8c8d;
            text-align: center;
        }
        
        .ersparnis-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .description-field {
            display: none;
        }
        
        .due-date-field {
            display: none;
        }
        
        .edit-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .edit-modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .auto-save-notice {
            text-align: center;
            color: #27ae60;
            font-size: 14px;
            margin-top: 10px;
            display: none;
        }
        
        .fixkosten-item {
            background: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .fixkosten-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .fixkosten-title {
            font-weight: 500;
            color: #2c3e50;
        }
        
        .fixkosten-amount {
            font-weight: bold;
            color: #f39c12;
        }
        
        .fixkosten-details {
            font-size: 14px;
            color: #7f8c8d;
        }
        
        .fixkosten-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
            justify-content: flex-end;
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 15px;
            background: #ecf0f1;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filter-btn.active {
            background: #3498db;
            color: white;
        }
        
        .filter-btn:hover {
            background: #dfe6e9;
        }
        
        .filter-btn.active:hover {
            background: #2980b9;
        }
        
        /* Neue Styles f√ºr Fixkosten-Summenanzeige */
        .fixkosten-summary {
            background: white;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .fixkosten-summary h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .fixkosten-total {
            font-size: 20px;
            font-weight: bold;
        }
        
        .fixkosten-total.current-month {
            color: #e74c3c;
        }
        
        .fixkosten-item.current-month {
            border-left: 5px solid #e74c3c;
        }
        
        .fixkosten-item.other-month {
            border-left: 5px solid #f39c12;
        }
        
        /* Neue Styles f√ºr Login-Bildschirm */
        #loginScreen { 
            display: flex; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: white; 
            z-index: 10000; 
            justify-content: center; 
            align-items: center; 
            flex-direction: column;
        }
        .login-container {
            max-width: 400px; 
            padding: 20px; 
            background: white; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .user-menu {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .family-name {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #3498db;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
        .admin-only { 
            display: none; 
        }
        
        @media (max-width: 600px) {
            .summary-cards {
                grid-template-columns: 1fr 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .transaction-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .transaction-amount {
                margin-top: 5px;
            }
            
            .transaction-actions {
                margin-top: 10px;
                width: 100%;
                justify-content: flex-end;
            }
            
            .month-display {
                position: relative;
                top: 0;
                right: 0;
                margin-top: 10px;
                display: inline-block;
            }
            
            .filter-buttons {
                flex-direction: column;
            }
            
            .user-menu {
                position: relative;
                top: 0;
                left: 0;
                margin-bottom: 15px;
                justify-content: center;
            }
            
            .family-name {
                position: relative;
                top: 0;
                left: 0;
                transform: none;
                margin: 10px 0;
                display: inline-block;
            }
			/* ==================== SUCHE STYLES ==================== */
			#transactionSearch {
			    transition: all 0.3s ease;
			    font-size: 14px;
			}
			
			#transactionSearch:focus {
			    outline: none;
			    border-color: #3498db;
			    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
			    width: 250px;
			}
			
			/* Responsive Design f√ºr Mobile */
			@media (max-width: 768px) {
			    .transactions > div:first-child {
			        flex-direction: column;
			        align-items: flex-start;
			        gap: 15px;
			    }
			    
			    #transactionSearch {
			        width: 100% !important;
			        max-width: 300px;
			    }
			    
			    .filter-buttons {
			        overflow-x: auto;
			        padding-bottom: 5px;
			    }
			    
			    .filter-buttons::-webkit-scrollbar {
			        height: 5px;
			    }
			    
			    .filter-buttons::-webkit-scrollbar-thumb {
			        background: #ccc;
			        border-radius: 10px;
			    }
			}
			
			/* Hervorhebungs-Style */
			.transaction-search-highlight {
			    background: #ffeb3b;
			    padding: 2px 4px;
			    border-radius: 3px;
			    font-weight: bold;
			}
        }
    </style>
</head>
<body>
    <!-- Login-Bildschirm -->
    <div id="loginScreen">
        <div class="login-container">
            <h2 style="text-align: center; margin-bottom: 20px;">Familien-Finanzen</h2>
            <div id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">E-Mail</label>
                    <input type="email" id="loginEmail" class="form-control">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Passwort</label>
                    <input type="password" id="loginPassword" class="form-control">
                </div>
                <button class="btn btn-add" onclick="login()" style="width: 100%;">Anmelden</button>
                <button class="btn" onclick="showRegister()" style="width: 100%; margin-top: 10px; background: #7f8c8d;">Registrieren</button>
            </div>
            <div id="registerForm" style="display: none;">
                <div class="form-group">
                    <label for="registerName">Name</label>
                    <input type="text" id="registerName" class="form-control">
                </div>
                <div class="form-group">
                    <label for="registerEmail">E-Mail</label>
                    <input type="email" id="registerEmail" class="form-control">
                </div>
                <div class="form-group">
                    <label for="registerPassword">Passwort</label>
                    <input type="password" id="registerPassword" class="form-control">
                </div>
                <div class="form-group">
                    <label for="registerFamilyCode">Familiencode (optional)</label>
                    <input type="text" id="registerFamilyCode" class="form-control" placeholder="Leer lassen f√ºr neue Familie">
                </div>
                <button class="btn btn-add" onclick="register()" style="width: 100%;">Registrieren</button>
                <button class="btn" onclick="showLogin()" style="width: 100%; margin-top: 10px; background: #7f8c8d;">Zur√ºck zum Login</button>
            </div>
        </div>
    </div>

    <div class="container" style="display: none;" id="appContainer">
        <div class="user-menu">
            <span id="userName"></span>
            <button class="btn" onclick="logout()" style="padding: 5px 10px; font-size: 12px;">Abmelden</button>
        </div>
        <div class="family-name" id="familyNameDisplay">Familie</div>
        
        <div class="header">
            <h1>üí∞ Familien Finanzen</h1>
            <p>Gemeinsame Einkommens- und Ausgaben√ºberwachung</p>
            <div class="month-display" id="monthDisplay">September</div>
        </div>

        <!-- Zusammenfassung -->
        <div class="summary-cards">
            <div class="card income" onclick="showIncomeSection()">
                <h3>Einkommen</h3>
                <div class="amount" id="totalIncome">0,00 ‚Ç¨</div>
            </div>
            <div class="card expense" onclick="showExpenseSection()">
                <h3>Ausgaben</h3>
                <div class="amount" id="totalExpense">0,00 ‚Ç¨</div>
            </div>
            <div class="card fixkosten" onclick="showFixkostenSection()">
                <h3>Fixkosten</h3>
                <div class="amount" id="totalFixkosten">0,00 ‚Ç¨</div>
            </div>
            <div class="card balance" id="bankBalanceCard">
                <h3>Kalan</h3>
                <div class="amount" id="bankBalance">0,00 ‚Ç¨</div>
            </div>
            <div class="card ersparnis" onclick="showErsparnisSection()">
                <h3>Ersparnis</h3>
                <div class="amount" id="ersparnisAmount">0,00 ‚Ç¨</div>
            </div>
            <div class="card cekilem" onclick="showCekilenSection()">
                <h3>√áekilen</h3>
                <div class="amount" id="cekilenAmount">0,00 ‚Ç¨</div>
            </div>
        </div>

        <!-- Budget √úbersicht -->
        <div class="budget-section">
            <h3>Budget √úbersicht</h3>
            <div class="budget-item" onclick="filterTransactionsByCategory('Mutfak')">
                <div class="budget-header">
                    <span>Mutfak</span>
                    <span id="mutfakBudgetText">0 / 0 ‚Ç¨</span>
                </div>
                <div class="budget-progress">
                    <div class="budget-progress-bar" id="mutfakProgress"></div>
                </div>
                <div class="budget-text" id="mutfakPercentage">0%</div>
            </div>
            <div class="budget-item" onclick="filterTransactionsByCategory('Extra Kosten')">
                <div class="budget-header">
                    <span>Extra Kosten</span>
                    <span id="extraBudgetText">0 / 0 ‚Ç¨</span>
                </div>
                <div class="budget-progress">
                    <div class="budget-progress-bar" id="extraProgress"></div>
                </div>
                <div class="budget-text" id="extraPercentage">0%</div>
            </div>
            <div class="budget-item" onclick="filterTransactionsByCategory('Benzin')">
                <div class="budget-header">
                    <span>Benzin</span>
                    <span id="benzinBudgetText">0 / 0 ‚Ç¨</span>
                </div>
                <div class="budget-progress">
                    <div class="budget-progress-bar" id="benzinProgress"></div>
                </div>
                <div class="budget-text" id="benzinPercentage">0%</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('income')">Einkommen</button>
            <button class="tab" onclick="showTab('expense')">Ausgaben</button>
            <button class="tab" onclick="showTab('fixkosten')">Fixkosten</button>
            <button class="tab" onclick="showTab('ersparnis')">Ersparnis</button>
            <button class="tab" onclick="showTab('budget')">Budget</button>
            <button class="tab admin-only" onclick="showTab('family')">Familie</button>
        </div>

        <!-- Einkommen Tab -->
        <div id="incomeTab" class="tab-content">
            <h3>Einkommen hinzuf√ºgen</h3>
            <form onsubmit="addIncome(event)">
                <div class="form-group">
                    <label for="incomeCategory">Kategorie</label>
                    <select id="incomeCategory" required>
                        <option value="">Kategorie w√§hlen</option>
                        <option value="Gehalt Sait">Gehalt Sait</option>
                        <option value="Gehalt K√ºbra">Gehalt K√ºbra</option>
                        <option value="Kindergeld">Kindergeld</option>
                        <option value="Extra gelirler">Extra gelirler</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="incomeAmount">Betrag (‚Ç¨)</label>
                    <input type="number" id="incomeAmount" step="0.01" required>
                </div>
                <button type="submit" class="btn btn-add">Einkommen hinzuf√ºgen</button>
            </form>
        </div>

        <!-- Ausgaben Tab -->
        <div id="expenseTab" class="tab-content" style="display: none;">
            <h3>Ausgabe hinzuf√ºgen</h3>
            <form onsubmit="addExpense(event)">
                <div class="form-group">
                    <label for="expenseCategory">Kategorie</label>
                    <select id="expenseCategory" required onchange="toggleExpenseFields()">
                        <option value="">Kategorie w√§hlen</option>
                        <option value="Mutfak">Mutfak</option>
                        <option value="Extra Kosten">Extra Kosten</option>
                        <option value="Benzin">Benzin</option>
                        <option value="√áekilen">√áekilen</option>
                    </select>
                </div>
                <div class="form-group" id="expenseDescriptionGroup" style="display: none;">
                    <label for="expenseDescription">Beschreibung</label>
                    <textarea id="expenseDescription" placeholder="Beschreibe die Ausgabe..."></textarea>
                </div>
                <div class="form-group">
                    <label for="expenseAmount">Betrag (‚Ç¨)</label>
                    <input type="number" id="expenseAmount" step="0.01" required>
                </div>
                <button type="submit" class="btn btn-add">Ausgabe hinzuf√ºgen</button>
            </form>
        </div>

        <!-- Fixkosten Tab -->
        <div id="fixkostenTab" class="tab-content" style="display: none;">
            <h3>Fixkosten hinzuf√ºgen</h3>
            <form onsubmit="addFixkosten(event)">
                <div class="form-group">
                    <label for="fixkostenTitle">Titel</label>
                    <input type="text" id="fixkostenTitle" required placeholder="z.B. Miete, Strom, Versicherung">
                </div>
                <div class="form-group">
                    <label for="fixkostenAmount">Betrag (‚Ç¨)</label>
                    <input type="number" id="fixkostenAmount" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="fixkostenInterval">Zahlungsintervall</label>
                    <select id="fixkostenInterval" required>
                        <option value="monthly">Monatlich</option>
                        <option value="bimonthly">Alle zwei Monate</option>
                        <option value="quarterly">Alle drei Monate</option>
                        <option value="half-yearly">Halbj√§hrlich</option>
                        <option value="yearly">J√§hrlich</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="fixkostenNextDue">N√§chste F√§lligkeit</label>
                    <input type="date" id="fixkostenNextDue" required>
                </div>
                <div class="form-group">
                    <label for="fixkostenEndDate">Enddatum (optional)</label>
                    <input type="date" id="fixkostenEndDate">
                </div>
                <button type="submit" class="btn btn-add">Fixkosten hinzuf√ºgen</button>
            </form>

            <!-- Fixkosten Summen-Anzeige -->
            <div class="fixkosten-summary">
                <h4>Fixkosten f√ºr diesen Monat</h4>
                <div class="fixkosten-total current-month" id="currentMonthFixkostenTotal">0,00 ‚Ç¨</div>
            </div>

            <div id="fixkostenList" style="margin-top: 30px;">
                <h3>Meine Fixkosten</h3>
                <div id="fixkostenItems">
                    <div style="padding: 20px; text-align: center; color: #7f8c8d;">
                        Noch keine Fixkosten vorhanden
                    </div>
                </div>
            </div>
        </div>

        <!-- Ersparnis Tab -->
        <div id="ersparnisTab" class="tab-content" style="display: none;">
            <div class="ersparnis-section">
                <h3>Ersparnis verwalten</h3>
                <p>√áekilen wird automatisch zur Ersparnis hinzugef√ºgt. Ersparnis wird nicht zur√ºckgesetzt.</p>
                <div class="form-group">
                    <label for="ersparnisAmountInput">Ersparnis Betrag (‚Ç¨)</label>
                    <input type="number" id="ersparnisAmountInput" step="0.01" onchange="updateErsparnis(this.value)">
                </div>
            </div>
        </div>

        <!-- Budget Tab -->
        <div id="budgetTab" class="tab-content" style="display: none;">
            <h3>Budget festlegen</h3>
            <div class="form-group">
                <label for="mutfakBudget">Mutfak Budget (‚Ç¨)</label>
                <input type="number" id="mutfakBudget" step="0.01" onchange="updateBudget('mutfak', this.value)">
            </div>
            <div class="form-group">
                <label for="extraBudget">Extra Kosten Budget (‚Ç¨)</label>
                <input type="number" id="extraBudget" step="0.01" onchange="updateBudget('extra', this.value)">
            </div>
            <div class="form-group">
                <label for="benzinBudget">Benzin Budget (‚Ç¨)</label>
                <input type="number" id="benzinBudget" step="0.01" onchange="updateBudget('benzin', this.value)">
            </div>
        </div>

        <!-- Familien Tab -->
        <div id="familyTab" class="tab-content" style="display: none;">
            <h3>Familienverwaltung</h3>
            <div class="form-group">
                <label>Familienmitglieder</label>
                <div id="familyMembersList">
                    <!-- Wird dynamisch gef√ºllt -->
                </div>
            </div>
            
            <div class="form-group">
                <label>Einladungscode</label>
                <div style="display: flex;">
                    <input type="text" id="invitationCode" readonly class="form-control">
                    <button class="btn" onclick="copyInvitationCode()" style="margin-left: 10px;">Kopieren</button>
                </div>
                <small>Teilen Sie diesen Code mit Familienmitgliedern, damit sie beitreten k√∂nnen</small>
            </div>
        </div>

        <!-- Transaktionsliste mit Filter-Buttons -->
        <div class="transactions">
            <h3>üìã Transaktionen 
                <span id="filterIndicator" style="font-size: 14px; font-weight: normal;"></span>
            </h3>
			
            <!-- SUCHFELD HIER EINF√úGEN -->
	        <div style="display: flex; align-items: center; gap: 10px;">
	            <div style="position: relative;">
	                <input type="text" id="transactionSearch" placeholder="Suchen..." 
	                       style="padding: 10px 35px 10px 15px; border: 2px solid #ddd; border-radius: 20px; width: 200px;"
	                       onkeyup="handleSearch()">
	                <span style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: #7f8c8d;">
	                    üîç
	                </span>
	            </div>
	            <button onclick="clearSearch()" style="background: #6c757d; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">
	                ‚úñ
	            </button>
		        </div>
		    </div>
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="filterTransactions('all')">Alle</button>
                <button class="filter-btn" onclick="filterTransactions('income')">Einkommen</button>
                <button class="filter-btn" onclick="filterTransactions('expense')">Ausgaben</button>
                <button class="filter-btn" onclick="filterTransactions('fixkosten')">Fixkosten</button>
                <button class="filter-btn" onclick="filterTransactionsByCategory('Mutfak')">Mutfak</button>
                <button class="filter-btn" onclick="filterTransactionsByCategory('Extra Kosten')">Extra</button>
                <button class="filter-btn" onclick="filterTransactionsByCategory('Benzin')">Benzin</button>
            </div>
            
            <div id="transactionList">
                <div style="padding: 20px; text-align: center; color: #7f8c8d;">
                    Noch keine Transaktionen vorhanden
                </div>
            </div>
			<div id="transactionSum" style="padding: 15px 20px; text-align: right; font-weight: bold; color: #2c3e50;">
				Summe: 0,00 ‚Ç¨
			</div>

        </div>

        <!-- Speichern Button -->
        <button class="btn btn-save" onclick="saveData()">üíæ Daten speichern</button>
        <div class="auto-save-notice" id="autoSaveNotice">Daten wurden automatisch gespeichert!</div>
    </div>

    <!-- Bearbeitungs-Modal f√ºr Transaktionen -->
    <div class="edit-modal" id="editModal">
        <div class="edit-modal-content">
            <h3>Transaktion bearbeiten</h3>
            <form onsubmit="saveEditedTransaction(event)">
                <input type="hidden" id="editTransactionId">
                <div class="form-group">
                    <label for="editType">Typ</label>
                    <select id="editType" required onchange="toggleEditFields()">
                        <option value="income">Einkommen</option>
                        <option value="expense">Ausgabe</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editCategory">Kategorie</label>
                    <select id="editCategory" required>
                        <option value="Gehalt Sait">Gehalt Sait</option>
                        <option value="Gehalt K√ºbra">Gehalt K√ºbra</option>
                        <option value="Kindergeld">Kindergeld</option>
                        <option value="Extra gelirler">Extra gelirler</option>
                        <option value="Mutfak">Mutfak</option>
                        <option value="Extra Kosten">Extra Kosten</option>
                        <option value="Benzin">Benzin</option>
                        <option value="√áekilen">√áekilen</option>
                    </select>
                </div>
                <div class="form-group" id="editDescriptionGroup">
                    <label for="editDescription">Beschreibung</label>
                    <textarea id="editDescription" placeholder="Beschreibe die Transaktion..."></textarea>
                </div>
                <div class="form-group">
                    <label for="editAmount">Betrag (‚Ç¨)</label>
                    <input type="number" id="editAmount" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="editDate">Datum</label>
                    <input type="date" id="editDate" required>
                </div>
                <button type="submit" class="btn btn-add">Speichern</button>
                <button type="button" class="btn" style="background: #7f8c8d; margin-top: 10px;" onclick="closeEditModal()">Abbrechen</button>
            </form>
        </div>
    </div>

    <!-- Bearbeitungs-Modal f√ºr Fixkosten -->
    <div class="edit-modal" id="editFixkostenModal">
        <div class="edit-modal-content">
            <h3>Fixkosten bearbeiten</h3>
            <form onsubmit="saveEditedFixkosten(event)">
                <input type="hidden" id="editFixkostenId">
                <div class="form-group">
                    <label for="editFixkostenTitle">Titel</label>
                    <input type="text" id="editFixkostenTitle" required>
                </div>
                <div class="form-group">
                    <label for="editFixkostenAmount">Betrag (‚Ç¨)</label>
                    <input type="number" id="editFixkostenAmount" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="editFixkostenInterval">Zahlungsintervall</label>
                    <select id="editFixkostenInterval" required>
                        <option value="monthly">Monatlich</option>
                        <option value="bimonthly">Alle zwei Monate</option>
                        <option value="quarterly">Alle drei Monate</option>
                        <option value="half-yearly">Halbj√§hrlich</option>
                        <option value="yearly">J√§hrlich</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editFixkostenNextDue">N√§chste F√§lligkeit</label>
                    <input type="date" id="editFixkostenNextDue" required>
                </div>
                <div class="form-group">
                    <label for="editFixkostenEndDate">Enddatum (optional)</label>
                    <input type="date" id="editFixkostenEndDate">
                </div>
                <button type="submit" class="btn btn-add">Speichern</button>
                <button type="button" class="btn" style="background: #7f8c8d; margin-top: 10px;" onclick="closeEditFixkostenModal()">Abbrechen</button>
            </form>
        </div>
    </div>

    <script>
        // ==================== FIREBASE KONFIGURATION ====================
        // Ihre Firebase-Konfiguration
        const firebaseConfig = {
            apiKey: "AIzaSyA5sif1OER2laidwjl_WklqAEFVWDOrYbk",
            authDomain: "finanzhaushalt-28f07.firebaseapp.com",
            databaseURL: "https://finanzhaushalt-28f07-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "finanzhaushalt-28f07",
            storageBucket: "finanzhaushalt-28f07.firebasestorage.app",
            messagingSenderId: "597159299613",
            appId: "1:597159299613:web:dd6b0a7a03ec2c6c8a94f4"
        };

        // Firebase initialisieren
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
		
		// ==================== GITHUB PAGES DETEKTION ====================
        function isGitHubPages() {
            return window.location.hostname.includes('github.io');
        }

        // ==================== GLOBALE VARIABLEN ====================
        let currentUser = null;
        let currentFamily = null;
        let familyData = {};
        let transactions = [];
        let budgets = {
            mutfak: 0,
            extra: 0,
            benzin: 0
        };
        let ersparnis = 0;
        let lastResetDate = null;
        let fixkosten = [];
        let currentFilter = 'all';
        let unsubscribeListener = null;

        // ==================== AUTHENTIFIZIERUNG ====================
        // Auth State Observer
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
                document.getElementById('userName').textContent = user.displayName || user.email;
                checkUserFamily();
            } else {
                currentUser = null;
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('appContainer').style.display = 'none';
                if (unsubscribeListener) unsubscribeListener();
            }
        });

        // Login-Funktion
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                alert('Login fehlgeschlagen: ' + error.message);
            }
        }

        // Registrierungs-Funktion
        async function register() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const familyCode = document.getElementById('registerFamilyCode').value;
            
            try {
                // Benutzer erstellen
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                await userCredential.user.updateProfile({ displayName: name });
                
                // Familie beitreten oder erstellen
                if (familyCode) {
                    await joinFamily(familyCode, userCredential.user.uid, name);
                } else {
                    await createFamily(userCredential.user.uid, name);
                }
            } catch (error) {
                alert('Registrierung fehlgeschlagen: ' + error.message);
            }
        }

        // Abmelden
        function logout() {
            auth.signOut();
        }

        // Formular-Wechsel
        function showRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        }

        function showLogin() {
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
        }

        // ==================== FAMILIENVERWALTUNG ====================
        // Familie erstellen
        async function createFamily(userId, userName) {
            // Familiencode generieren
            const familyCode = generateFamilyCode();
            
            // Familie in Firestore erstellen
            const familyRef = db.collection('families').doc();
            await familyRef.set({
                name: `${userName}'s Familie`,
                created: new Date(),
                owner: userId,
                members: {
                    [userId]: {
                        name: userName,
                        role: 'admin',
                        joined: new Date()
                    }
                },
                joinCode: familyCode
            });
            
            currentFamily = familyRef.id;
            await setupDataListener();
        }

        // Familie beitreten
        async function joinFamily(familyCode, userId, userName) {
            // Familie mit Code finden
            const familyQuery = await db.collection('families').where('joinCode', '==', familyCode).get();
            
            if (familyQuery.empty) {
                alert('Ung√ºltiger Familiencode');
                return;
            }
            
            const familyDoc = familyQuery.docs[0];
            currentFamily = familyDoc.id;
            familyData = familyDoc.data();
            
            // Benutzer zur Familie hinzuf√ºgen
            await db.collection('families').doc(currentFamily).update({
                [`members.${userId}`]: {
                    name: userName,
                    role: 'member',
                    joined: new Date()
                }
            });
            
            await setupDataListener();
        }

        // Pr√ºfen, zu welcher Familie der Benutzer geh√∂rt
        async function checkUserFamily() {
            // Zuerst pr√ºfen, ob wir bereits eine Familie haben
            if (currentFamily) {
                await setupDataListener();
                return;
            }
            
            // Ansonsten in Firebase nach der Familie suchen
            try {
                const familyQuery = await db.collection('families')
                    .where(`members.${currentUser.uid}`, '!=', null)
                    .get();
                
                if (!familyQuery.empty) {
                    const familyDoc = familyQuery.docs[0];
                    currentFamily = familyDoc.id;
                    familyData = familyDoc.data();
                    await setupDataListener();
                } else {
                    // Benutzer geh√∂rt keiner Familie an - erstelle eine neue
                    await createFamily(currentUser.uid, currentUser.displayName || currentUser.email);
                }
            } catch (error) {
                console.error("Fehler bei der Familienpr√ºfung: ", error);
                // Fallback: Erstelle eine neue Familie
                await createFamily(currentUser.uid, currentUser.displayName || currentUser.email);
            }
        }

        // Hilfsfunktion zur Generierung eines Familiencodes
        function generateFamilyCode() {
            return Math.random().toString(36).substring(2, 10).toUpperCase();
        }

        // Einladungscode kopieren
        function copyInvitationCode() {
            const codeInput = document.getElementById('invitationCode');
            codeInput.select();
            document.execCommand('copy');
            alert('Code kopiert!');
        }

        // Familienmitgliederliste aktualisieren
        function updateFamilyMembersList() {
            const membersList = document.getElementById('familyMembersList');
            if (!familyData.members) return;
            
            membersList.innerHTML = '';
            for (const [userId, member] of Object.entries(familyData.members)) {
                membersList.innerHTML += `
                    <div style="padding: 10px; border-bottom: 1px solid #eee;">
                        <strong>${member.name}</strong> 
                        <span style="color: #777;">(${member.role})</span>
                        ${userId === currentUser.uid ? '<em>(Sie)</em>' : ''}
                    </div>
                `;
            }
        }

        // ==================== DATENVERWALTUNG ====================
        // Daten-Listener einrichten
        async function setupDataListener() {
    		if (unsubscribeListener) unsubscribeListener();
    
    		try {
		        console.log('Setting up Firestore listener for family:', currentFamily);
		        
		        // Listener f√ºr die Finanzdaten
		        unsubscribeListener = db.collection('families').doc(currentFamily).collection('data').doc('financeData')
		            .onSnapshot((doc) => {
		                if (doc.exists) {
		                    const data = doc.data();
		                    console.log('Daten empfangen:', data);
		                    
		                    // Daten immer √ºbernehmen, egal von welchem Benutzer
		                    transactions = data.transactions || [];
		                    budgets = data.budgets || { mutfak: 0, extra: 0, benzin: 0 };
		                    ersparnis = data.ersparnis || 0;
		                    lastResetDate = data.lastResetDate ? new Date(data.lastResetDate) : null;
		                    fixkosten = data.fixkosten || [];
		                    
		                    updateDisplay();
		                } else {
		                    // Dokument existiert nicht - erstelle leeres Dokument
		                    console.log('Dokument existiert nicht, erstelle leeres Dokument');
		                    saveData(); // Erstellt das Dokument
		                }
		            }, (error) => {
		                console.error('Firestore Listener Fehler:', error);
		                alert('Verbindungsfehler: ' + error.message);
		            });
		        
		        // Familienname und Mitglieder laden
		        try {
		            const familyDoc = await db.collection('families').doc(currentFamily).get();
		            if (familyDoc.exists) {
		                familyData = familyDoc.data();
		                document.getElementById('familyNameDisplay').textContent = familyData.name;
		                document.getElementById('invitationCode').value = familyData.joinCode;
		                updateFamilyMembersList();
		            }
		        } catch (error) {
		            console.error('Fehler beim Laden der Familiedaten:', error);
		        }
		        
		    } catch (error) {
		        console.error("Fehler beim Einrichten des Listeners: ", error);
		        alert("Datenbankverbindung fehlgeschlagen: " + error.message);
		    }
		}

        // Daten speichern (angepasst f√ºr Firebase)
        async function saveData() {
		    if (!currentUser || !currentFamily) {
		        console.error('Kein Benutzer oder Familie ausgew√§hlt');
		        return;
		    }
		    
		    try {
		        const saveData = {
		            transactions: transactions,
		            budgets: budgets,
		            ersparnis: ersparnis,
		            lastResetDate: lastResetDate,
		            fixkosten: fixkosten,
		            lastUpdated: new Date(),
		            lastUpdatedBy: currentUser.uid
		        };
		        
		        console.log('Speichere Daten:', saveData);
		        
		        await db.collection('families').doc(currentFamily).collection('data').doc('financeData').set(saveData);
		        
		        // Speicherbest√§tigung anzeigen
		        const notice = document.getElementById('autoSaveNotice');
		        notice.style.display = 'block';
		        setTimeout(() => {
		            notice.style.display = 'none';
		        }, 2000);
		        
		    } catch (error) {
		        console.error("Fehler beim Speichern: ", error);
		        alert("Speichern fehlgeschlagen: " + error.message);
		    }
		}


        // UI basierend auf Berechtigungen aktualisieren
        function updateUIBasedOnPermissions() {
            const isAdmin = familyData.members && familyData.members[currentUser.uid] && 
                           familyData.members[currentUser.uid].role === 'admin';
            
            // Admin-only Elemente ein-/ausblenden
            document.querySelectorAll('.admin-only').forEach(el => {
                el.style.display = isAdmin ? 'block' : 'none';
            });
            
            // Transaktionsaktionen f√ºr Nicht-Admins ausblenden
            if (!isAdmin) {
                document.querySelectorAll('.transaction-actions').forEach(el => {
                    el.style.display = 'none';
                });
            }
        }

		// ==================== FEHLERBEHEBUNG IN AUTH STATE CHANGE ====================
		auth.onAuthStateChanged(async (user) => {
		    if (user) {
		        currentUser = user;
		        document.getElementById('loginScreen').style.display = 'none';
		        document.getElementById('appContainer').style.display = 'block';
		        document.getElementById('userName').textContent = user.displayName || user.email;
		        
		        // Warten bis Familie geladen ist, dann Listener starten
		        await checkUserFamily();
		        
		    } else {
		        currentUser = null;
		        document.getElementById('loginScreen').style.display = 'flex';
		        document.getElementById('appContainer').style.display = 'none';
		        if (unsubscribeListener) unsubscribeListener();
		    }
		});

		// ==================== DEBUGGING HINZUF√úGEN ====================
		// F√ºgen Sie diese Funktion hinzu um den aktuellen Status zu pr√ºfen
		function checkDataStatus() {
		    console.log('Aktuelle Daten:');
		    console.log('Transactions:', transactions);
		    console.log('Budgets:', budgets);
		    console.log('Ersparnis:', ersparnis);
		    console.log('Fixkosten:', fixkosten);
		    console.log('Current Family:', currentFamily);
		    console.log('Current User:', currentUser ? currentUser.uid : 'Kein Benutzer');
		}

        // ==================== IHRE ORIGINALEN FUNKTIONEN (angepasst) ====================
        // Initialisierung
        document.addEventListener('DOMContentLoaded', function() {
            // Heutiges Datum f√ºr Fixkosten setzen
            const today = new Date();
            const nextMonth = new Date(today.getFullYear(), today.getMonth() + 1, 1);
            document.getElementById('fixkostenNextDue').value = nextMonth.toISOString().split('T')[0];
            
            // Testweise localStorage-Daten laden, falls vorhanden (f√ºr √úbergangsphase)
            try {
                const localData = localStorage.getItem('financeData');
                if (localData) {
                    const data = JSON.parse(localData);
                    transactions = data.transactions || [];
                    budgets = data.budgets || { mutfak: 0, extra: 0, benzin: 0 };
                    ersparnis = data.ersparnis || 0;
                    lastResetDate = data.lastResetDate ? new Date(data.lastResetDate) : null;
                    fixkosten = data.fixkosten || [];
                    
                    updateDisplay();
                }
            } catch (e) {
                console.log("Keine lokalen Daten gefunden");
            }
        });
		
		// Ersparnis-Bereich anzeigen
		function showErsparnisSection() {
			showTab('ersparnis');
        
			// Zum Ersparnis-Bereich scrollen
			setTimeout(() => {
				const ersparnisSection = document.getElementById('ersparnisTab');
				if (ersparnisSection) {
					ersparnisSection.scrollIntoView({ behavior: 'smooth' });
				}
			}, 100);
		}
		
		// √áekilen-Bereich anzeigen
		function showCekilenSection() {
			// Speziellen Filter f√ºr √áekilen setzen
			currentFilter = '√áekilen';
			updateFilterButtons();
			updateTransactionList();
    
			// Filter-Indikator aktualisieren
			document.getElementById('filterIndicator').textContent = '(Gefiltert nach: √áekilen)';
    
			// Zum Transaktionsbereich scrollen
			setTimeout(() => {
				const transactionSection = document.querySelector('.transactions');
				if (transactionSection) {
					transactionSection.scrollIntoView({ behavior: 'smooth' });
				}
			}, 100);
		}
		
        // Monatsanzeige aktualisieren
        function updateMonthDisplay() {
            const now = new Date();
            const monthNames = ["Januar", "Februar", "M√§rz", "April", "Mai", "Juni",
                "Juli", "August", "September", "Oktober", "November", "Dezember"
            ];
            
            // Wenn der aktuelle Tag >= 26, zeige den n√§chsten Monat
            let displayMonth = now.getMonth();
            if (now.getDate() >= 26) {
                displayMonth = (now.getMonth() + 1) % 12;
            }
            
            document.getElementById('monthDisplay').textContent = monthNames[displayMonth];
        }

        // Monatliche Zur√ºcksetzung pr√ºfen
        function checkMonthlyReset() {
            const now = new Date();
            const today = now.getDate();
            
            // Pr√ºfen, ob heute der 26. oder sp√§ter ist und wir noch nicht zur√ºckgesetzt haben
            if (today >= 26) {
                const resetDate = new Date(now.getFullYear(), now.getMonth(), 26);
                
                // Wenn wir noch nicht in diesem Monat zur√ºckgesetzt haben
                if (!lastResetDate || lastResetDate < resetDate) {
                    resetMonthlyData();
                    lastResetDate = now;
                    saveData();
                }
            }
        }

        // Monatliche Daten zur√ºcksetzen
        function resetMonthlyData() {
            // √áekilen zur Ersparnis hinzuf√ºgen
            const cekilenAmount = transactions
                .filter(t => t.category === '√áekilen' && t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
            
            // Nur hinzuf√ºgen, wenn es √áekilen-Ausgaben gibt
            if (cekilenAmount > 0) {
                ersparnis += cekilenAmount;
                
                // Ausgaben f√ºr Mutfak, Extra Kosten und √áekilen l√∂schen
                transactions = transactions.filter(t => 
                    !(t.type === 'expense' && (t.category === 'Mutfak' || t.category === 'Extra Kosten' || t.category === '√áekilen'))
                );
                
                // Budgets zur√ºcksetzen
                budgets.mutfak = 0;
                budgets.extra = 0;
                budgets.benzin = 0;
                
                alert('Monatliche Zur√ºcksetzung durchgef√ºhrt. ' + cekilenAmount.toFixed(2) + ' ‚Ç¨ √áekilen wurde zur Ersparnis hinzugef√ºgt.');
                updateDisplay();
            }
        }

        // Beschreibungsfeld ein-/ausblenden
        function toggleExpenseFields() {
            const category = document.getElementById('expenseCategory').value;
            const descriptionGroup = document.getElementById('expenseDescriptionGroup');
            
            if (category === 'Extra Kosten') {
                descriptionGroup.style.display = 'block';
            } else {
                descriptionGroup.style.display = 'none';
                document.getElementById('expenseDescription').value = '';
            }
        }

        // Einkommen-Bereich anzeigen
        function showIncomeSection() {
            showTab('income');
            filterTransactions('income');
            
            // Zum Transaktionsbereich scrollen
            setTimeout(() => {
                const transactionSection = document.querySelector('.transactions');
                if (transactionSection) {
                    transactionSection.scrollIntoView({ behavior: 'smooth' });
                }
            }, 100);
        }

        // Ausgaben-Bereich anzeigen
        function showExpenseSection() {
            showTab('expense');
            filterTransactions('expense');
            
            // Zum Transaktionsbereich scrollen
            setTimeout(() => {
                const transactionSection = document.querySelector('.transactions');
                if (transactionSection) {
                    transactionSection.scrollIntoView({ behavior: 'smooth' });
                }
            }, 100);
        }

        // Fixkosten-Bereich anzeigen
        function showFixkostenSection() {
            showTab('fixkosten');
            
            
            // Zum Fixkosten-Bereich scrollen (nicht zum Transaktionsbereich)
            setTimeout(() => {
                const fixkostenSection = document.getElementById('fixkostenTab');
                if (fixkostenSection) {
                    fixkostenSection.scrollIntoView({ behavior: 'smooth' });
                }
            }, 100);
        }

        // Tab-Funktionen
        function showTab(tabName) {
            // Alle Tabs verstecken
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Alle Tab-Buttons deaktivieren
            document.querySelectorAll('.tab').forEach(button => {
                button.classList.remove('active');
            });
            
            // Gew√§hlten Tab anzeigen
            document.getElementById(tabName + 'Tab').style.display = 'block';
            
            // Aktiven Tab-Button finden und aktivieren
            const tabButtons = document.querySelectorAll('.tab');
            for (let i = 0; i < tabButtons.length; i++) {
                if (tabButtons[i].textContent.toLowerCase().includes(tabName.toLowerCase())) {
                    tabButtons[i].classList.add('active');
                    break;
                }
            }
        }

        // Zu einem Bereich scrollen
        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth' });
            }
        }

		// ==================== SUCHFUNKTIONEN ====================
		let currentSearchTerm = '';
		
		function handleSearch() {
		    const searchTerm = document.getElementById('transactionSearch').value.toLowerCase().trim();
		    currentSearchTerm = searchTerm;
		    
		    if (searchTerm === '') {
		        // Wenn Suche leer, normalen Filter anwenden
		        applyCurrentFilter();
		    } else {
		        // Suche durchf√ºhren
		        performSearch(searchTerm);
		    }
		}
		
		function performSearch(searchTerm) {
		    let filteredTransactions = transactions;
		    
		    // Zuerst aktuellen Filter anwenden
		    if (currentFilter !== 'all' && currentFilter !== 'search') {
		        if (currentFilter === 'income') {
		            filteredTransactions = filteredTransactions.filter(t => t.type === 'income');
		        } else if (currentFilter === 'expense') {
		            filteredTransactions = filteredTransactions.filter(t => t.type === 'expense');
		        } else if (currentFilter === 'fixkosten') {
		            // F√ºr Fixkosten-Filter zeigen wir keine Transaktionen an
		            document.getElementById('transactionList').innerHTML = `
		                <div style="padding: 20px; text-align: center; color: #7f8c8d;">
		                    Fixkosten werden oben im Fixkosten-Tab verwaltet
		                </div>
		            `;
		            return;
		        } else if (['Mutfak', 'Extra Kosten', 'Benzin', '√áekilen'].includes(currentFilter)) {
		            filteredTransactions = filteredTransactions.filter(t => t.category === currentFilter);
		        }
		    }
		    
		    // Dann Suche anwenden
		    const searchResults = filteredTransactions.filter(transaction => {
		        // Suche in verschiedenen Feldern
		        const searchableText = [
		            transaction.category || '',
		            transaction.description || '',
		            transaction.amount ? transaction.amount.toString() : '',
		            transaction.date || ''
		        ].join(' ').toLowerCase();
		        
		        return searchableText.includes(searchTerm);
		    });
		    
		    // Ergebnisse anzeigen
		    displaySearchResults(searchResults, searchTerm);
		}
		
		function displaySearchResults(results, searchTerm) {
		    const listElement = document.getElementById('transactionList');
		    const sumElement = document.getElementById('transactionSum');
		    const indicator = document.getElementById('filterIndicator');
		    
		    if (results.length === 0) {
		        listElement.innerHTML = `
		            <div style="padding: 20px; text-align: center; color: #7f8c8d;">
		                Keine Transaktionen gefunden f√ºr: "${searchTerm}"
		            </div>
		        `;
		        sumElement.textContent = 'Summe: 0,00 ‚Ç¨';
		        indicator.textContent = `(Suchergebnis: "${searchTerm}")`;
		        return;
		    }
		    
		    // Transaktionen mit Hervorhebung anzeigen
		    listElement.innerHTML = results.map(transaction => `
		        <div class="transaction-item">
		            <div class="transaction-info">
		                <div class="transaction-category">
		                    ${highlightText(transaction.category, searchTerm)}
		                </div>
		                ${transaction.description ? `
		                    <div class="transaction-description">
		                        ${highlightText(transaction.description, searchTerm)}
		                    </div>
		                ` : ''}
		                <div class="transaction-date">
		                    ${new Date(transaction.date).toLocaleDateString('de-DE')}
		                </div>
		            </div>
		            <div class="transaction-amount ${transaction.type}">
		                ${transaction.type === 'income' ? '+' : '-'}${transaction.amount.toFixed(2)} ‚Ç¨
		            </div>
		            <div class="transaction-actions">
		                <button class="edit-btn" onclick="editTransaction(${transaction.id})">‚úèÔ∏è</button>
		                <button class="delete-btn" onclick="deleteTransaction(${transaction.id})">üóëÔ∏è</button>
		            </div>
		        </div>
		    `).join('');
		    
		    // Summe berechnen
		    const sum = results.reduce((total, t) => {
		        return t.type === 'income' ? total + t.amount : total - t.amount;
		    }, 0);
		    
		    sumElement.textContent = 'Summe: ' + sum.toFixed(2).replace('.', ',') + ' ‚Ç¨';
		    indicator.textContent = `(Suchergebnis: "${searchTerm}" - ${results.length} Treffer)`;
		}
		
		function highlightText(text, searchTerm) {
		    if (!searchTerm) return text;
		    
		    const regex = new RegExp(`(${searchTerm})`, 'gi');
		    return text.replace(regex, '<span style="background: #ffeb3b; padding: 2px 4px; border-radius: 3px;">$1</span>');
		}
		
		function clearSearch() {
		    document.getElementById('transactionSearch').value = '';
		    currentSearchTerm = '';
		    applyCurrentFilter();
		}
		
		function applyCurrentFilter() {
		    // Setze Filter-Indicator zur√ºck
		    const indicator = document.getElementById('filterIndicator');
		    
		    if (currentFilter === 'all') {
		        indicator.textContent = '';
		    } else {
		        indicator.textContent = `(Gefiltert nach: ${currentFilter})`;
		    }
		    
		    // Normale Filter-Funktion aufrufen
		    if (['income', 'expense', 'fixkosten'].includes(currentFilter)) {
		        filterTransactions(currentFilter);
		    } else if (['Mutfak', 'Extra Kosten', 'Benzin', '√áekilen'].includes(currentFilter)) {
		        filterTransactionsByCategory(currentFilter);
		    } else {
		        filterTransactions('all');
		    }
		}

        let currentFilter = 'all'; // Globale Variable f√ºr aktuellen Filter

		function filterTransactions(type) {
		    currentFilter = type;
		    currentSearchTerm = ''; // Suche zur√ºcksetzen
		    document.getElementById('transactionSearch').value = '';
		    updateFilterButtons();
		    updateTransactionList();
		}
		
		function filterTransactionsByCategory(category) {
		    currentFilter = category;
		    currentSearchTerm = ''; // Suche zur√ºcksetzen
		    document.getElementById('transactionSearch').value = '';
		    updateFilterButtons();
		    updateTransactionList();
		}
		
		// updateTransactionList Funktion anpassen
		function updateTransactionList() {
		    if (currentSearchTerm) {
		        // Wenn Suche aktiv, Suchfunktion verwenden
		        performSearch(currentSearchTerm);
		        return;
		    }
            
            // Zum Transaktionsbereich scrollen
            setTimeout(() => {
                const transactionSection = document.querySelector('.transactions');
                if (transactionSection) {
                    transactionSection.scrollIntoView({ behavior: 'smooth' });
                }
            }, 100);
        }

        // Filter-Buttons aktualisieren
        function updateFilterButtons() {
            const buttons = document.querySelectorAll('.filter-btn');
            buttons.forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Aktiven Button finden und aktivieren
            const activeBtn = Array.from(buttons).find(btn => {
                if (currentFilter === 'all') return btn.textContent === 'Alle';
                if (currentFilter === 'income') return btn.textContent === 'Einkommen';
                if (currentFilter === 'expense') return btn.textContent === 'Ausgaben';
                if (currentFilter === 'fixkosten') return btn.textContent === 'Fixkosten';
                return btn.textContent === currentFilter;
            });
            
            if (activeBtn) {
                activeBtn.classList.add('active');
            } else {
                buttons[0].classList.add('active'); // Fallback: "Alle" aktivieren
            }
            
            // Filter-Indikator aktualisieren
            const indicator = document.getElementById('filterIndicator');
            if (currentFilter === 'all') {
                indicator.textContent = '';
            } else {
                indicator.textContent = `(Gefiltert nach: ${currentFilter})`;
            }
        }

        // Einkommen hinzuf√ºgen
        function addIncome(event) {
            event.preventDefault();
            
            const category = document.getElementById('incomeCategory').value;
            const amount = parseFloat(document.getElementById('incomeAmount').value);
            
            const transaction = {
                id: Date.now(),
                type: 'income',
                category: category,
                amount: amount,
                date: new Date().toISOString().split('T')[0]
            };
            
            transactions.unshift(transaction);
            updateDisplay();
            saveData();
            
            // Formular zur√ºcksetzen
            document.getElementById('incomeCategory').value = '';
            document.getElementById('incomeAmount').value = '';
        }

        // Ausgabe hinzuf√ºgen
        function addExpense(event) {
            event.preventDefault();
            
            const category = document.getElementById('expenseCategory').value;
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const description = document.getElementById('expenseDescription').value;
            
            const transaction = {
                id: Date.now(),
                type: 'expense',
                category: category,
                amount: amount,
                date: new Date().toISOString().split('T')[0],
                description: (category === 'Extra Kosten') ? description : ''
            };
            
            transactions.unshift(transaction);
            
            // Wenn es sich um eine √áekilen-Ausgabe handelt, zur Ersparnis hinzuf√ºgen
            if (category === '√áekilen') {
                ersparnis += amount;
            }
            
            updateDisplay();
            saveData();
            
            // Formular zur√ºcksetzen
            document.getElementById('expenseCategory').value = '';
            document.getElementById('expenseAmount').value = '';
            document.getElementById('expenseDescription').value = '';
            document.getElementById('expenseDescriptionGroup').style.display = 'none';
        }

        // Fixkosten hinzuf√ºgen
        function addFixkosten(event) {
            event.preventDefault();
            
            const title = document.getElementById('fixkostenTitle').value;
            const amount = parseFloat(document.getElementById('fixkostenAmount').value);
            const interval = document.getElementById('fixkostenInterval').value;
            const nextDue = document.getElementById('fixkostenNextDue').value;
            const endDate = document.getElementById('fixkostenEndDate').value;
            
            const fixkostenItem = {
                id: Date.now(),
                title: title,
                amount: amount,
                interval: interval,
                nextDue: nextDue,
                endDate: endDate || null
            };
            
            fixkosten.push(fixkostenItem);
            updateFixkostenDisplay();
            updateDisplay();
            saveData();
            
            // Formular zur√ºcksetzen
            document.getElementById('fixkostenTitle').value = '';
            document.getElementById('fixkostenAmount').value = '';
            document.getElementById('fixkostenEndDate').value = '';
        }

        // Fixkosten bearbeiten
        function editFixkosten(id) {
            const fixkostenItem = fixkosten.find(f => f.id === id);
            if (!fixkostenItem) return;
            
            document.getElementById('editFixkostenId').value = id;
            document.getElementById('editFixkostenTitle').value = fixkostenItem.title;
            document.getElementById('editFixkostenAmount').value = fixkostenItem.amount;
            document.getElementById('editFixkostenInterval').value = fixkostenItem.interval;
            document.getElementById('editFixkostenNextDue').value = fixkostenItem.nextDue;
            document.getElementById('editFixkostenEndDate').value = fixkostenItem.endDate || '';
            
            // Modal anzeigen
            document.getElementById('editFixkostenModal').style.display = 'flex';
        }

        // Bearbeitete Fixkosten speichern
        function saveEditedFixkosten(event) {
            event.preventDefault();
            
            const id = parseInt(document.getElementById('editFixkostenId').value);
            const title = document.getElementById('editFixkostenTitle').value;
            const amount = parseFloat(document.getElementById('editFixkostenAmount').value);
            const interval = document.getElementById('editFixkostenInterval').value;
            const nextDue = document.getElementById('editFixkostenNextDue').value;
            const endDate = document.getElementById('editFixkostenEndDate').value;
            
            const index = fixkosten.findIndex(f => f.id === id);
            if (index !== -1) {
                fixkosten[index] = {
                    ...fixkosten[index],
                    title: title,
                    amount: amount,
                    interval: interval,
                    nextDue: nextDue,
                    endDate: endDate || null
                };
                
                updateFixkostenDisplay();
                updateDisplay();
                saveData();
                closeEditFixkostenModal();
            }
        }

        // Fixkosten l√∂schen
        function deleteFixkosten(id) {
            if (confirm('M√∂chten Sie diese Fixkosten wirklich l√∂schen?')) {
                fixkosten = fixkosten.filter(f => f.id !== id);
                updateFixkostenDisplay();
                updateDisplay();
                saveData();
            }
        }

        // Bearbeitungs-Modal f√ºr Fixkosten schlie√üen
        function closeEditFixkostenModal() {
            document.getElementById('editFixkostenModal').style.display = 'none';
        }

        // ==================== KORRIGIERTE FIXKOSTEN-ANZEIGE ====================
		function updateFixkostenDisplay() {
		    const fixkostenContainer = document.getElementById('fixkostenItems');
		    const now = new Date();
		    const currentMonth = now.getMonth();
		    const currentYear = now.getFullYear();
		
		    if (fixkosten.length === 0) {
		        fixkostenContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: #7f8c8d;">Noch keine Fixkosten vorhanden</div>';
		        document.getElementById('currentMonthFixkostenTotal').textContent = '0,00 ‚Ç¨';
		        return;
		    }
		
		    let currentMonthTotal = 0;
		    let fixkostenHTML = '';
		
		    fixkosten.forEach(item => {
		        const nextDue = new Date(item.nextDue);
		        const isCurrentMonth = nextDue.getMonth() === currentMonth && nextDue.getFullYear() === currentYear;
		
		        // Addiere zur Gesamtsumme, wenn es der aktuelle Monat ist
		        if (isCurrentMonth) {
		            currentMonthTotal += item.amount;
		        }
		
		        const intervalText = {
		            'monthly': 'monatlich',
		            'bimonthly': 'alle zwei Monate',
		            'quarterly': 'alle drei Monate',
		            'half-yearly': 'halbj√§hrlich',
		            'yearly': 'j√§hrlich'
		        }[item.interval] || item.interval;
		
		        const endDateText = item.endDate ? ` ‚Ä¢ Endet am: ${new Date(item.endDate).toLocaleDateString('de-DE')}` : '';
		
		        // KORRIGIERTE HTML-Struktur - geschlossene Tags und korrekte Formatierung
		        fixkostenHTML += `
		            <div class="fixkosten-item ${isCurrentMonth ? 'current-month' : 'other-month'}">
		                <div class="fixkosten-header">
		                    <span class="fixkosten-title">${item.title}</span>
		                    <span class="fixkosten-amount" style="color: ${isCurrentMonth ? '#e74c3c' : '#f39c12'}">${item.amount.toFixed(2)} ‚Ç¨</span>
		                </div>
		                <div class="fixkosten-details">
		                    ${intervalText} ‚Ä¢ N√§chste F√§lligkeit: ${new Date(item.nextDue).toLocaleDateString('de-DE')}${endDateText}
		                    ${isCurrentMonth ? ' <span style="color:#e74c3c; font-weight:bold;">(Dieser Monat)</span>' : ''}
		                </div>
		                <div class="fixkosten-actions">
		                    <button class="edit-btn" onclick="editFixkosten(${item.id})">‚úèÔ∏è</button>
		                    <button class="delete-btn" onclick="deleteFixkosten(${item.id})">üóëÔ∏è</button>
		                </div>
		            </div>
		        `;
		    });
		
		    fixkostenContainer.innerHTML = fixkostenHTML;
		    document.getElementById('currentMonthFixkostenTotal').textContent = currentMonthTotal.toFixed(2) + ' ‚Ç¨';
		}
    
			        
        // Berechne monatliche Fixkosten f√ºr den aktuellen Monat
		function calculateMonthlyFixkosten() {
			const now = new Date();
			const currentMonth = now.getMonth();
			const currentYear = now.getFullYear();
			
			let monthlyFixkosten = 0;
			
			fixkosten.forEach(item => {
				// Pr√ºfe ob Fixkosten noch aktiv (kein Enddatum oder Enddatum in der Zukunft)
				const endDate = item.endDate ? new Date(item.endDate) : null;
				if (endDate && endDate < now) {
					return; // √úberspringe abgelaufene Fixkosten
				}
				
				// Pr√ºfe ob die n√§chste F√§lligkeit in diesem Monat liegt
				const nextDue = new Date(item.nextDue);
				if (nextDue.getMonth() === currentMonth && nextDue.getFullYear() === currentYear) {
					// Verwende den vollen Betrag statt den monatlichen Anteil
					monthlyFixkosten += item.amount;
				}
			});
			
			return monthlyFixkosten;
		}

        // Ersparnis aktualisieren
        function updateErsparnis(amount) {
            ersparnis = parseFloat(amount) || 0;
            updateDisplay();
            saveData();
        }

        // Budget aktualisieren
        function updateBudget(category, amount) {
            budgets[category] = parseFloat(amount) || 0;
            updateBudgetDisplay();
            saveData();
        }

        // Transaktion bearbeiten
        function editTransaction(id) {
            const transaction = transactions.find(t => t.id === id);
            if (!transaction) return;
            
            // Alten Betrag speichern f√ºr eventuelle Anpassungen der Ersparnis
            const oldAmount = transaction.amount;
            const oldCategory = transaction.category;
            
            document.getElementById('editTransactionId').value = id;
            document.getElementById('editType').value = transaction.type;
            document.getElementById('editCategory').value = transaction.category;
            document.getElementById('editAmount').value = transaction.amount;
            document.getElementById('editDate').value = transaction.date;
            document.getElementById('editDescription').value = transaction.description || '';
            
            // Felder basierend auf Typ und Kategorie anzeigen/ausblenden
            toggleEditFields();
            
            // Modal anzeigen
            document.getElementById('editModal').style.display = 'flex';
        }

        // Bearbeitungsfelder ein-/ausblenden
        function toggleEditFields() {
            const type = document.getElementById('editType').value;
            const category = document.getElementById('editCategory').value;
            const descriptionGroup = document.getElementById('editDescriptionGroup');
            
            if (type === 'expense' && category === 'Extra Kosten') {
                descriptionGroup.style.display = 'block';
            } else {
                descriptionGroup.style.display = 'none';
            }
        }

        // Bearbeitete Transaktion speichern
        function saveEditedTransaction(event) {
            event.preventDefault();
            
            const id = parseInt(document.getElementById('editTransactionId').value);
            const type = document.getElementById('editType').value;
            const category = document.getElementById('editCategory').value;
            const amount = parseFloat(document.getElementById('editAmount').value);
            const date = document.getElementById('editDate').value;
            const description = document.getElementById('editDescription').value;
            
            const index = transactions.findIndex(t => t.id === id);
            if (index !== -1) {
                const oldTransaction = transactions[index];
                
                // Wenn sich die Kategorie von √áekilen ge√§ndert hat oder der Betrag
                if (oldTransaction.category === '√áekilen' && oldTransaction.type === 'expense') {
                    if (category !== '√áekilen' || type !== 'expense') {
                        // √áekilen wurde entfernt, also von der Ersparnis abziehen
                        ersparnis -= oldTransaction.amount;
                    } else if (amount !== oldTransaction.amount) {
                        // Betrag wurde ge√§ndert, Differenz anpassen
                        ersparnis -= oldTransaction.amount;
                        ersparnis += amount;
                    }
                } else if (category === '√áekilen' && type === 'expense') {
                    // Neue √áekilen-Transaktion hinzugef√ºgt
                    ersparnis += amount;
                }
                
                transactions[index] = {
                    ...oldTransaction,
                    type: type,
                    category: category,
                    amount: amount,
                    date: date,
                    description: description
                };
                
                updateDisplay();
                saveData();
                closeEditModal();
            }
        }

        // Bearbeitungs-Modal schlie√üen
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        // Transaktion l√∂schen
        function deleteTransaction(id) {
            if (confirm('M√∂chten Sie diese Transaktion wirklich l√∂schen?')) {
                const transaction = transactions.find(t => t.id === id);
                
                // Wenn es eine √áekilen-Transaktion ist, von der Ersparnis abziehen
                if (transaction && transaction.category === '√áekilen' && transaction.type === 'expense') {
                    ersparnis -= transaction.amount;
                }
                
                transactions = transactions.filter(t => t.id !== id);
                updateDisplay();
                saveData();
            }
        }

        // Anzeige aktualisieren
        function updateDisplay() {
            updateSummary();
            updateTransactionList();
            updateBudgetDisplay();
            updateErsparnisDisplay();
            updateFixkostenDisplay();
            updateMonthDisplay();
        }

        // Zusammenfassung aktualisieren
        function updateSummary() {
            const totalIncome = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const totalExpenseWithoutFixkosten = transactions
				.filter(t => t.type === 'expense')
				.reduce((sum, t) => sum + t.amount, 0);

			// Berechne monatliche Fixkosten
			const monthlyFixkosten = calculateMonthlyFixkosten();

			// Gesamt-Ausgaben = normale Ausgaben + monatliche Fixkosten
			const totalExpense = totalExpenseWithoutFixkosten + monthlyFixkosten;

			const bankBalance = totalIncome - totalExpense;

                
            const cekilenAmount = transactions
                .filter(t => t.category === '√áekilen' && t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
                
            
            
            document.getElementById('totalIncome').textContent = totalIncome.toFixed(2) + ' ‚Ç¨';
            document.getElementById('totalExpense').textContent = totalExpense.toFixed(2) + ' ‚Ç¨';
            document.getElementById('totalFixkosten').textContent = monthlyFixkosten.toFixed(2) + ' ‚Ç¨';
            document.getElementById('bankBalance').textContent = bankBalance.toFixed(2) + ' ‚Ç¨';
            document.getElementById('cekilenAmount').textContent = cekilenAmount.toFixed(2) + ' ‚Ç¨';
            
            // Bankada Kalan Farbe basierend auf dem Wert anpassen
            const bankBalanceCard = document.getElementById('bankBalanceCard');
            if (bankBalance < 0) {
                bankBalanceCard.classList.add('negative');
            } else {
                bankBalanceCard.classList.remove('negative');
            }
        }

        // Ersparnis-Anzeige aktualisieren
        function updateErsparnisDisplay() {
            document.getElementById('ersparnisAmount').textContent = ersparnis.toFixed(2) + ' ‚Ç¨';
            document.getElementById('ersparnisAmountInput').value = ersparnis;
        }

        // Transaktionsliste aktualisieren
        function updateTransactionList() {
            const listElement = document.getElementById('transactionList');
            
            // Transaktionen filtern
            let filteredTransactions = transactions;
            
            if (currentFilter === 'income') {
                filteredTransactions = transactions.filter(t => t.type === 'income');
            } else if (currentFilter === 'expense') {
                filteredTransactions = transactions.filter(t => t.type === 'expense');
            } else if (currentFilter === 'fixkosten') {
                // F√ºr Fixkosten-Filter zeigen wir keine Transaktionen an
                listElement.innerHTML = `
                    <div style="padding: 20px; text-align: center; color: #7f8c8d;">
                        Fixkosten werden oben im Fixkosten-Tab verwaltet
                    </div>
                `;
                return;
            } else if (['Mutfak', 'Extra Kosten', 'Benzin', '√áekilen'].includes(currentFilter)) {
                filteredTransactions = transactions.filter(t => t.category === currentFilter);
            }
            
            if (filteredTransactions.length === 0) {
                listElement.innerHTML = '<div style="padding: 20px; text-align: center; color: #7f8c8d;">Keine Transaktionen gefunden</div>';
                return;
            }
            
            listElement.innerHTML = filteredTransactions.map(transaction => `
                <div class="transaction-item">
                    <div class="transaction-info">
                        <div class="transaction-category">${transaction.category}</div>
                        ${transaction.description ? `<div class="transaction-description">${transaction.description}</div>` : ''}
                        <div class="transaction-date">${new Date(transaction.date).toLocaleDateString('de-DE')}</div>
                    </div>
                    <div class="transaction-amount ${transaction.type}">
                        ${transaction.type === 'income' ? '+' : '-'}${transaction.amount.toFixed(2)} ‚Ç¨
                    </div>
                    <div class="transaction-actions">
                        <button class="edit-btn" onclick="editTransaction(${transaction.id})">‚úèÔ∏è</button>
                        <button class="delete-btn" onclick="deleteTransaction(${transaction.id})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
			// Summe aller angezeigten Transaktionen berechnen
			const sum = filteredTransactions.reduce((total, t) => {
				return t.type === 'income' ? total + t.amount : total - t.amount;
			}, 0);

			document.getElementById('transactionSum').textContent = 
				'Summe: ' + sum.toFixed(2).replace('.', ',') + ' ‚Ç¨';

        }

        // Budget-Anzeige aktualisieren
        function updateBudgetDisplay() {
            updateBudgetItem('mutfak', 'Mutfak');
            updateBudgetItem('extra', 'Extra Kosten');
            updateBudgetItem('benzin', 'Benzin');
        }

        function updateBudgetItem(category, categoryName) {
            const budget = budgets[category];
            const spent = transactions
                .filter(t => t.category === categoryName && t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);
                
            const percentage = budget > 0 ? (spent / budget) * 100 : 0;
            
            document.getElementById(category + 'BudgetText').textContent = `${spent.toFixed(2)} / ${budget.toFixed(2)} ‚Ç¨`;
            document.getElementById(category + 'Percentage').textContent = `${Math.min(percentage, 100).toFixed(1)}%`;
            
            const progressBar = document.getElementById(category + 'Progress');
            progressBar.style.width = Math.min(percentage, 100) + '%';
            
            // Farbe basierend auf Verbrauch
            progressBar.className = 'budget-progress-bar ';
            if (percentage < 70) {
                progressBar.className += 'safe';
            } else if (percentage < 90) {
                progressBar.className += 'warning';
            } else {
                progressBar.className += 'danger';
            }
            
            // Budget-Eingabefeld mit aktuellem Wert f√ºllen
            if (document.getElementById(category + 'Budget')) {
                document.getElementById(category + 'Budget').value = budget;
            }
        }
    </script>
</body>
</html>
